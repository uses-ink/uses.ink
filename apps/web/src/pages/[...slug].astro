---
import PostLayout from "@/layouts/PostLayout.astro";
import RootLayout from "@/layouts/RootLayout.astro";
import { getRepoRequest, renderContent } from "@uses.ink/server";

import { logger } from "@uses.ink/server-logger";
import Rendered from "@uses.ink/components/Rendered.astro";
import { FetchError } from "@uses.ink/errors";

const repoRequest = getRepoRequest(
	Astro.request.headers.get("host"),
	Astro.request.url,
);

logger.info("repoRequest", repoRequest);
let rendered = null;
try {
    rendered = await renderContent(repoRequest);
} catch (e) {
    logger.error(e);
    Astro.response.status = 500;
    Astro.response.statusText = "Internal Server Error";
}
---

<RootLayout>
    <PostLayout>
        <Rendered rendered={rendered} repoRequest={repoRequest} />
    </PostLayout>
</RootLayout>
